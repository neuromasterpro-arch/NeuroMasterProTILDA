<script>
   // ------------ДЕБАГ БЛОК------------
function secretBlock(response, formData) {
    let block = document.querySelector('.block2');

    if (!block) {
        block = document.createElement("section");
        block.classList.add("block2");

        block.innerHTML = `
            <form class="form2" id="form2">
                <div class="form2__wrap">
                  <div class="form2__wrap-info" id="adminFieldContent">
                    Поле1: Выводит роль чата (задается роль на сервере)
                  </div>
                </div>
                <div class="form2__wrap">
                  <div class="form2__wrap-info" id="use_prompt_modification">
                    Поле2: Пользовательский промт (Формируется на сервере, данные берутся из заполненных полей на сайте + текст на сервере).
                  </div>
                </div>
                <div class="form2__wrap">
                  <div class="form2__wrap-info" id="secret_answer">
                    Поле3: Выводит данные формы полей Блока 1 (формируется на сайте: текст + данные формы).
                  </div>
                </div>
                <div class="form2__wrap">
                  <div class="form2__wrap-info" id="system_info">
                    Поле4: Выводит системные данные.
                  </div>
                </div>
            </form>
        `;

        const target = App.selectors.generatedContent;
        target.parentNode.insertBefore(block, target.nextSibling);
    }

    const pole1 = block.querySelector('#adminFieldContent');
    const pole2 = block.querySelector('#use_prompt_modification');
    const pole3 = block.querySelector('#secret_answer');
    const pole4 = block.querySelector('#system_info');

    if (response.isSuccess) {
        pole1.textContent = "Роль чата: " + response.debug_result.adminFieldContent;
        pole2.textContent = "Пользовательский промт: " + response.debug_result.use_promt;
        pole3.textContent = formData || "";
        pole4.innerHTML = outputSystemInfo(response);
    } else {
        pole1.textContent = response[0];
        pole2.textContent = response[0];
        pole3.textContent = formData || "";
        pole4.textContent = "";
    }
}

function promptGenerate(formData, currentId) {
    
    const currentBlock = document.getElementById(currentId);
    if (!currentBlock) {
        console.warn(`Элемент с id="${currentId}" не найден`);
        return;
    }

    const section = document.createElement("section");
    section.classList.add("block5");
    section.innerHTML = `
        <form class="form5">
            <div class="form5__wrap">
                <p class="form5__wrap-info">${formData}</p>
            </div>
        </form>
    `;

    currentBlock.parentNode.insertBefore(section, currentBlock.nextSibling);
}

window.addEventListener('formSubmitted', (e) => {
    const {messageData, responseMessage} = e.detail || {};
    secretBlock(responseMessage, messageData);
    promptGenerate(messageData, App.state.tempBlockId);
})
</script>